# Overview

An overview of the various scenarios

## Overview of combinations

<table>
<thead>
<tr>
<th>Scenario</th>
<th>type of export</th>
<th>target</th>
<th>(in)direct</th>
<th>error</th>
<th>hoisting</th>
<th>`module.exports` of circular module</th>
</tr>
</thead>
<tbody>
<tr>
<td>regular</td>
<td>default</td>
<td>es5</td>
<td>direct</td>
<td>-</td>
<td>no</td>
<td>`{}`</td>
</tr>
<tr>
<td>regular es6</td>
<td>default</td>
<td>es6</td>
<td>direct</td>
<td>y<sup><a href="#user-content-fn-1-39e27ae64b7d78fdbf3ce2275bebb171" id="user-content-fnref-1-39e27ae64b7d78fdbf3ce2275bebb171" data-footnote-ref="" aria-describedby="footnote-label">1</a></sup></td>
<td>no</td>
<td>`{ default: getterFn() }`</td>
</tr>
<tr>
<td>regular es6 var</td>
<td>default</td>
<td>es6</td>
<td>direct</td>
<td>y<sup><a href="#user-content-fn-1-39e27ae64b7d78fdbf3ce2275bebb171" id="user-content-fnref-1-2-39e27ae64b7d78fdbf3ce2275bebb171" data-footnote-ref="" aria-describedby="footnote-label">1</a></sup></td>
<td>yes</td>
<td>`{ default: getterFn() }`</td>
</tr>
<tr>
<td>regular indirect</td>
<td>default</td>
<td>es5</td>
<td>indirect, functions</td>
<td>y<sup><a href="#user-content-fn-2-39e27ae64b7d78fdbf3ce2275bebb171" id="user-content-fnref-2-39e27ae64b7d78fdbf3ce2275bebb171" data-footnote-ref="" aria-describedby="footnote-label">2</a></sup></td>
<td>no</td>
<td>`{ default: expectedFn() }`</td>
</tr>
<tr>
<td>regular named exports</td>
<td>named</td>
<td>es5</td>
<td>direct</td>
<td>y<sup><a href="#user-content-fn-3-39e27ae64b7d78fdbf3ce2275bebb171" id="user-content-fnref-3-39e27ae64b7d78fdbf3ce2275bebb171" data-footnote-ref="" aria-describedby="footnote-label">3</a></sup></td>
<td>no</td>
<td>`{ [namedExportName]: getterFn() }`</td>
</tr>
<tr>
<td>named exports es6</td>
<td>named</td>
<td>es6</td>
<td>direct</td>
<td>y<sup><a href="#user-content-fn-3-39e27ae64b7d78fdbf3ce2275bebb171" id="user-content-fnref-3-2-39e27ae64b7d78fdbf3ce2275bebb171" data-footnote-ref="" aria-describedby="footnote-label">3</a></sup></td>
<td>no</td>
<td>`{ [namedExportName]: getterFn() }`</td>
</tr>
<tr>
<td>named indirect</td>
<td>named</td>
<td>es5</td>
<td>indirect, function</td>
<td>possibly<sup><a href="#user-content-fn-4-39e27ae64b7d78fdbf3ce2275bebb171" id="user-content-fnref-4-39e27ae64b7d78fdbf3ce2275bebb171" data-footnote-ref="" aria-describedby="footnote-label">4</a></sup></td>
<td>no</td>
<td>`{ [namedExportName]: getterFn() }`</td>
</tr>
<tr>
<td>class instance regular</td>
<td>default</td>
<td>es5</td>
<td>direct</td>
<td>y<sup><a href="#user-content-fn-5-39e27ae64b7d78fdbf3ce2275bebb171" id="user-content-fnref-5-39e27ae64b7d78fdbf3ce2275bebb171" data-footnote-ref="" aria-describedby="footnote-label">5</a></sup></td>
<td>no</td>
<td>`{}`</td>
</tr>
<tr>
<td>class instance named</td>
<td>default</td>
<td>es5</td>
<td>direct</td>
<td>y<sup><a href="#user-content-fn-3-39e27ae64b7d78fdbf3ce2275bebb171" id="user-content-fnref-3-3-39e27ae64b7d78fdbf3ce2275bebb171" data-footnote-ref="" aria-describedby="footnote-label">3</a></sup></td>
<td>no</td>
<td>`{ [namedExportName]: getterFn() }`</td>
</tr>
<tr>
<td>class instance indirect named</td>
<td>named</td>
<td>es5</td>
<td>indirect</td>
<td>possibly<sup><a href="#user-content-fn-4-39e27ae64b7d78fdbf3ce2275bebb171" id="user-content-fnref-4-2-39e27ae64b7d78fdbf3ce2275bebb171" data-footnote-ref="" aria-describedby="footnote-label">4</a></sup></td>
<td>no</td>
<td>`{ [namedExportName]: getterFn() }`</td>
</tr>
<tr>
<td>regular chunks entryPoints</td>
<td>default</td>
<td>es5</td>
<td>direct</td>
<td>-</td>
<td>no</td>
<td>`{}`</td>
</tr>
<tr>
<td>regular chunks dynamic import</td>
<td>default</td>
<td>es5</td>
<td>direct</td>
<td>-</td>
<td>no</td>
<td>`{}`</td>
</tr>
<tr>
<td>named chunks dynamic import</td>
<td>named</td>
<td>es5</td>
<td>indirect dynamic import</td>
<td>possibly<sup><a href="#user-content-fn-4-39e27ae64b7d78fdbf3ce2275bebb171" id="user-content-fnref-4-3-39e27ae64b7d78fdbf3ce2275bebb171" data-footnote-ref="" aria-describedby="footnote-label">4</a></sup></td>
<td>no</td>
<td>`{ [namedExportName]: getterFn() }`</td>
</tr>
<tr>
<td>named chunks dynamic import ESM</td>
<td>named</td>
<td>es6<sup><a href="#user-content-fn-6-39e27ae64b7d78fdbf3ce2275bebb171" id="user-content-fnref-6-39e27ae64b7d78fdbf3ce2275bebb171" data-footnote-ref="" aria-describedby="footnote-label">6</a></sup></td>
<td>indirect dynamic import</td>
<td>possibly<sup><a href="#user-content-fn-4-39e27ae64b7d78fdbf3ce2275bebb171" id="user-content-fnref-4-4-39e27ae64b7d78fdbf3ce2275bebb171" data-footnote-ref="" aria-describedby="footnote-label">4</a></sup></td>
<td>no</td>
<td>`{ [namedExportName]: getterFn() }`</td>
</tr>
</tbody>
</table>

<section data-footnotes="" className="footnotes">
<h2 id="footnote-label" className="sr-only" dir="auto">Footnotes</h2>
<ol dir="auto">
<li id="user-content-fn-1-39e27ae64b7d78fdbf3ce2275bebb171">
<p dir="auto">`Uncaught ReferenceError: Cannot access '__WEBPACK_DEFAULT_EXPORT__' before initialization` <a href="#user-content-fnref-1-39e27ae64b7d78fdbf3ce2275bebb171" data-footnote-backref="" aria-label="Back to reference 1" className="data-footnote-backref"><g-emoji className="g-emoji" alias="leftwards_arrow_with_hook" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/21a9.png">↩</g-emoji></a> <a href="#user-content-fnref-1-2-39e27ae64b7d78fdbf3ce2275bebb171" data-footnote-backref="" aria-label="Back to reference 1-2" className="data-footnote-backref"><g-emoji className="g-emoji" alias="leftwards_arrow_with_hook" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/21a9.png">↩</g-emoji><sup>2</sup></a></p>
</li>
<li id="user-content-fn-2-39e27ae64b7d78fdbf3ce2275bebb171">
<p dir="auto">`Maximum call stack size exceeded` <a href="#user-content-fnref-2-39e27ae64b7d78fdbf3ce2275bebb171" data-footnote-backref="" aria-label="Back to reference 2" className="data-footnote-backref"><g-emoji className="g-emoji" alias="leftwards_arrow_with_hook" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/21a9.png">↩</g-emoji></a></p>
</li>
<li id="user-content-fn-3-39e27ae64b7d78fdbf3ce2275bebb171">
<p dir="auto">`Uncaught ReferenceError: Cannot access '{{namedExportName}}' before initialization` <a href="#user-content-fnref-3-39e27ae64b7d78fdbf3ce2275bebb171" data-footnote-backref="" aria-label="Back to reference 3" className="data-footnote-backref"><g-emoji className="g-emoji" alias="leftwards_arrow_with_hook" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/21a9.png">↩</g-emoji></a> <a href="#user-content-fnref-3-2-39e27ae64b7d78fdbf3ce2275bebb171" data-footnote-backref="" aria-label="Back to reference 3-2" className="data-footnote-backref"><g-emoji className="g-emoji" alias="leftwards_arrow_with_hook" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/21a9.png">↩</g-emoji><sup>2</sup></a> <a href="#user-content-fnref-3-3-39e27ae64b7d78fdbf3ce2275bebb171" data-footnote-backref="" aria-label="Back to reference 3-3" className="data-footnote-backref"><g-emoji className="g-emoji" alias="leftwards_arrow_with_hook" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/21a9.png">↩</g-emoji><sup>3</sup></a></p>
</li>
<li id="user-content-fn-4-39e27ae64b7d78fdbf3ce2275bebb171">
<p dir="auto">depends on which named export is being called, if it returns a static value, no error or issues. If it calls a module within the circ dep chain, it will lead to `Maximum call stack size exceeded` <a href="#user-content-fnref-4-39e27ae64b7d78fdbf3ce2275bebb171" data-footnote-backref="" aria-label="Back to reference 4" className="data-footnote-backref"><g-emoji className="g-emoji" alias="leftwards_arrow_with_hook" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/21a9.png">↩</g-emoji></a> <a href="#user-content-fnref-4-2-39e27ae64b7d78fdbf3ce2275bebb171" data-footnote-backref="" aria-label="Back to reference 4-2" className="data-footnote-backref"><g-emoji className="g-emoji" alias="leftwards_arrow_with_hook" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/21a9.png">↩</g-emoji><sup>2</sup></a> <a href="#user-content-fnref-4-3-39e27ae64b7d78fdbf3ce2275bebb171" data-footnote-backref="" aria-label="Back to reference 4-3" className="data-footnote-backref"><g-emoji className="g-emoji" alias="leftwards_arrow_with_hook" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/21a9.png">↩</g-emoji><sup>3</sup></a> <a href="#user-content-fnref-4-4-39e27ae64b7d78fdbf3ce2275bebb171" data-footnote-backref="" aria-label="Back to reference 4-4" className="data-footnote-backref"><g-emoji className="g-emoji" alias="leftwards_arrow_with_hook" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/21a9.png">↩</g-emoji><sup>4</sup></a></p>
</li>
<li id="user-content-fn-5-39e27ae64b7d78fdbf3ce2275bebb171">
<p dir="auto">`cannot read {{propertyName}} of undefined`. The issue here is that the class is not exported yet, due to preliminary `module.exports = {}` <a href="#user-content-fnref-5-39e27ae64b7d78fdbf3ce2275bebb171" data-footnote-backref="" aria-label="Back to reference 5" className="data-footnote-backref"><g-emoji className="g-emoji" alias="leftwards_arrow_with_hook" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/21a9.png">↩</g-emoji></a></p>
</li>
<li id="user-content-fn-6-39e27ae64b7d78fdbf3ce2275bebb171">
<p dir="auto">also setting `output.module = true` and `experiments.outputModule = true` <a href="#user-content-fnref-6-39e27ae64b7d78fdbf3ce2275bebb171" data-footnote-backref="" aria-label="Back to reference 6" className="data-footnote-backref"><g-emoji className="g-emoji" alias="leftwards_arrow_with_hook" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/21a9.png">↩</g-emoji></a></p>
</li>
</ol>
</section>

## Legend

### `default` vs `named`

What kind of [ES Module export statement](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export) are we using.

Default: `export default`

Named: `export myVar` or `export { foo: varFoo, bar: varBar }`

This is important because circular dependencies with `default` exports are `undefined` when reading directly and using es5. 
This can lead to unexpected behavior, but will less likely lead to app-crashing errors.

Circular dependencies with named exports use getters and when used directly, will lead to 
`Uncaught ReferenceError: Cannot access '{{namedExportName}}' before initialization` errors which can crash your app if not caught properly.

### target

Which [Webpack output target](https://webpack.js.org/configuration/target/) are we setting?

The main difference here is that with `es6` and later, `default` exports are treated as named exports, using a getter. 
This can lead to `Uncaught ReferenceError: Cannot access '__WEBPACK_DEFAULT_EXPORT__' before initialization`

### (in)direct

Are we directly reading an imported value or are we deferring that in some way?

Direct read:
```js direct.js
import {foo} from './foo'

// directly reading and using `foo`. 
// If the `module.exports` for `foo.js` are not set correctly (due to a circ dep), 
// we might get unexpected behavior
const bar = foo + 'bar'

export default bar
```

Indirect read:
```js indirect.js
import {foo} from './foo'

function bar() {
  return foo + 'bar'
} 

// or

function dynamicImportBaz() {
  return import('./baz').then((module) => {
    return module.default + 'bar'
  })
}

export default bar
// export default dynamicImportBaz
```

The moment we access an imported value matters:

If we access a value from a circular module directly, it's exports will not be set yet. It will have the preliminary `module.exports = {}`.
However, if we read values from a circular module indirectly, we are able to finish processing all modules. 

The finishing part is important because webpack holds a *reference* to a module's `module.exports` and that can change once processing all modules is done:

```js entry.js
// needed to ensure right order of module processing for this example
import './moduleA.js';

import { direct, indirectFn } from './moduleB.js'

// All imports have been resolved and processed
// ModuleA's `module.exports` is correctly set: `{ default: 'bStatic imported from ./moduleB'}` 
console.log({direct, indirectFn: indirectFn() })
```

```js moduleA.js
import { bStatic } from './moduleB'

const useStaticValueFromB = `${bStatic} imported from ./moduleB`;

export default useStaticValueFromB;
```

```js moduleB.js
import useImportedValue from './moduleA';

// ModuleA's `module.exports` is preliminary set: `{}` 
const direct = useImportedValue;

// We only read `useImportedValue` when this function is called in `entry.js`
const indirectFn = () => useImportedValue;

const bStatic = 'bStatic'

export {direct, indirectFn, bStatic};
```

In the above example, by the time that we call `indirectFn()` in `entry.js` all modules have been fully processed by Webpack
and have their `module.exports` set to the correct value. 

It is important to realize that `module.exports` for `moduleA.js` is different when reading it in `moduleB.js` in direct, 
vs reading it in `entry.js` after all imports have been resolved.
